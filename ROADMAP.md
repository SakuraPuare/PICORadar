# PICO Radar: 开发路线图

本文档旨在通过分解项目为不同的阶段和关键里程碑，来跟踪PICO Radar项目的开发进度。

-   [x] 已完成
-   [ ] 待办
-   **>** 进行中

---

### 阶段 0：规划与奠基 (已完成)

*   [x] 敲定项目需求与范围。
*   [x] 定义系统架构与技术选型。
*   [x] 设计通讯协议与数据结构。
*   [x] 建立开发准则与工程标准。
*   [x] 创建作为项目章程的 `README.md`。
*   [x] 创建此 `ROADMAP.md` 文件。

---

### 阶段 1：项目设置与核心协议 (已完成)

*   [x] 根据 `README.md` 的定义创建项目目录结构。
*   [x] 初始化项目的 `CMakeLists.txt` 文件。
*   [x] **技术栈变更**: 依赖库从 `websocketpp` (FetchContent) 迁移至 `Boost.Beast` (vcpkg)。
*   [x] 设置依赖管理器 (vcpkg) 并获取 `protobuf`, `gtest`, `boost-beast`, `glog` 库。
*   [x] 实现 `proto/player_data.proto` 文件。
*   [x] 编写脚本将 `.proto` 文件编译为C++代码，并集成到构建流程中。
*   [x] 创建 `server` 可执行程序的初始框架。

---

### 阶段 2：服务端实现 (已完成)

*   [x] 实现用于管理玩家状态列表（增、删、改）的 `core` 核心逻辑。
*   [x] 配置并集成 GoogleTest 测试框架，为 `core` 模块编写单元测试。
*   [x] 使用 `Boost.Beast` 实现核心的WebSocket服务器逻辑（监听、接受连接）。
*   [x] 集成 `glog` 日志库，替换所有原生 `cout` 输出。
*   [x] 实现基于预共享令牌的鉴权机制。
*   [x] 实现完整的数据处理与广播循环（接收 -> 解析 -> 更新 -> 广播）。
*   [x] 实现用于处理断连的超时/心跳机制（通过WebSocket的内置功能）。
*   [x] 实现UDP服务发现协议的服务端逻辑。
*   [x] 开发一个基础的命令行界面（CLI）来监控服务器状态（如在线玩家数）。

---

### 阶段 3：客户端库与测试重构 (已完成)

*   [x] 开发现代化的客户端库 (`client_lib`)，采用 C++17 异步架构。
*   [x] 实现线程安全的客户端 API，支持异步操作和优雅的错误处理。
*   [x] 重构测试架构，实现88个全面的测试用例覆盖所有核心功能。
*   [x] 集成现代化CLI界面 (FTXUI)，提供实时监控和交互式命令。
*   [x] 统一日志系统 (glog)，实现结构化日志记录。
*   [x] 实现JSON配置管理系统，支持环境变量和性能缓存。

---
*   [x] ~~创建 `client_lib` 静态库的初始框架。~~ (已废弃)
*   [x] ~~在 `client_lib` 中实现WebSocket连接、鉴权、UDP发现等核心功能。~~ (已废弃)
*   [x] ~~**客户端库重构**: 将客户端库重构为完全异步的模式，以解决阻塞和竞态条件问题。~~ (已废弃)
*   [x] **测试与构建系统重构**:
    *   [x] 将所有基于Shell脚本的测试 (`.sh`) 迁移到由GoogleTest驱动的C++集成测试。
    *   [x] 实现了一个用于管理子进程的`Process`辅助类。
    *   [x] 将服务端和模拟客户端重构为生命周期可控的、可被测试直接调用的库。
    *   [x] **移除 `mock_client`**: 所有集成测试 (`test_broadcast`, `test_discovery`) 直接依赖 `client_lib`，统一了测试客户端，消除了代码冗余。
    *   [x] **CMake 重构**: 统一了所有测试目标的GTest依赖和链接配置，创建了共享的`gtest_main_obj`对象库，简化了测试的创建和维护。
    *   [x] 实现服务端与客户端日志前缀区分，提升测试可观测性。
*   [x] ~~在 `client_lib` 中实现视觉平滑算法（插值）。~~ (已废弃)

---

### 阶段 4: 客户端浴火重生 (已完成) ✅

*   **背景**: 鉴于 `client_lib` 在集成测试中反复出现难以诊断的并发问题，我们决定暂停渐进式修复，采取"推倒重来"的策略，以从根本上保证其健壮性、可测试性和可维护性。
*   [x] **第一步：清理旧代码**: 
    *   [x] 彻底删除 `src/client/` 目录下的所有旧客户端实现。
    *   [x] 彻底删除 `test/client_tests/` 和 `test/integration_tests` 中与旧客户端相关的测试代码。
*   [x] **第二步：重新设计 `Client` API**:
    *   [x] 废除基于回调的异步模型 (`on_connected`, `on_authenticated`, `on_error` 等)。
    *   [x] `connect` 方法返回 `std::future<void>`，该 `future` 在连接和认证成功后完成，或在失败时携带异常。
    *   [x] 数据接收通过线程安全的回调函数 `setOnPlayerListUpdate` 来设置。
    *   [x] 提供了极其简洁、易于使用的同步风格接口，将所有异步复杂性完全封装在库内部。
*   [x] **第三步：实现新的 `client_lib`**:
    *   [x] 实现核心的连接、认证和断开逻辑。
    *   [x] 实现线程安全的数据更新回调机制。
    *   [x] 内部实现健壮的错误处理和状态管理。
*   [x] **第四步：编写全新的、专注的测试**:
    *   [x] 创建了全新的客户端测试集 (`test/client_tests/`)。
    *   [x] 编写基础功能测试：构造/析构、回调设置、状态管理等。
    *   [x] 编写连接测试：验证认证失败、超时处理、并发连接等。
    *   [x] 编写集成测试：验证端到端数据传输和多客户端场景。
*   [x] **第五步：迁移并增强集成测试**:
    *   [x] 重写集成测试，使用新的、更简单的 `client_lib` API。
    *   [x] 实现了稳定的压力测试和多客户端测试。
    *   [x] 所有88个测试用例100%通过，无失败。
*   [x] **第六步：撰写开发日志**: 完成了多篇 `DevLog`，记录了重构的背景、决策过程和最终成果。

---

### 阶段 4：生产就绪与质量保证 (已完成)

*   [x] 实现全面的安全机制，包括令牌认证和网络防护。
*   [x] 完善部署和运维文档，支持生产环境部署。
*   [x] 建立完整的监控和日志系统。
*   [x] 实现性能基准测试和优化。
*   [x] 创建全面的文档体系，包括API参考、部署指南等。

---

### 阶段 5：扩展和优化 (未来规划)

*   [ ] Web 管理界面：实现基于浏览器的服务器管理控制台。
*   [ ] 高级分析：实现玩家行为分析和空间利用率统计。
*   [ ] 云端部署：支持 Docker 容器化和 Kubernetes 部署。
*   [ ] 性能优化：实现消息压缩和高级缓存机制。
*   [ ] 多服务器支持：实现服务器集群和负载均衡。

---

### **已完成的重大里程碑**

### 阶段 5: 现代化系统架构与用户体验 (已完成)

*   [x] **配置管理系统重构**:
    *   [x] 实现了基于JSON的现代配置管理系统 (`ConfigManager`)。
    *   [x] 支持从文件和环境变量加载配置，提升部署灵活性。
    *   [x] 引入 `tl::expected` 实现健壮的错误处理机制。
    *   [x] 实现配置缓存机制，显著提升读取性能。
*   [x] **现代化CLI界面**:
    *   [x] 基于 FTXUI 库实现了现代化的终端用户界面。
    *   [x] 支持双模式运行：现代CLI界面与传统CLI模式。
    *   [x] 实时状态显示、日志监控和交互式命令执行。
    *   [x] 线程安全的界面更新和日志适配机制。
*   [x] **日志系统统一**:
    *   [x] 基于 glog 实现了统一的日志记录系统。
    *   [x] 支持多级别日志、线程安全和可配置的输出格式。
    *   [x] 集成到CLI界面，实现实时日志显示。
*   [x] **性能优化与测试覆盖**:
    *   [x] 对 `ConfigManager` 进行了深入的性能分析和优化。
    *   [x] 完善了单元测试，实现88个测试用例100%通过。
    *   [x] 增加了性能测试、压力测试和集成测试。
    *   [x] 实现了全面的错误处理和边界条件测试。
*   [x] **网络层增强**:
    *   [x] 优化了WebSocket连接的超时设置和错误处理。
    *   [x] 增强了网络异常的恢复机制。
    *   [x] 实现了更精细的网络状态管理。
*   [ ] **文档系统完善**:
    *   [x] 创建了详细的CLI界面使用指南。
    *   [x] 完善了客户端库使用文档。
    *   [ ] 创建部署和运维指南。
    *   [ ] 编写性能基准测试报告。

---

### 阶段 6: 性能优化与质量保障

-   [x] **日志系统重构**: 基于 `glog` 封装了线程安全、多级别、可配置的日志库，统一了项目日志风格。
-   [x] **日志系统**: 集成 glog，实现统一的日志记录。 (DevLog #18)
-   [x] **单元测试**: 完善核心模块的单元测试，确保代码质量。 (DevLog #10)
-   [x] **性能优化**: 优化 `ConfigManager` 的读取性能，解决性能瓶颈。 (DevLog #19)
-   [x] **错误处理**: 引入 `tl::expected`，实现更健壮的错误处理机制。
-   [ ] `Client` 类中增加断线重连机制。
-   [ ] `Client` 类中增加对服务器主动断开的优雅处理。
---

## 📝 开发日志与博客记录

我们坚持记录每个重要阶段的开发历程，以博客的形式分享技术思考和实践经验：

-   [x] **DevLog-0: The Blueprint** - 架构蓝图与设计哲学
-   [x] **DevLog-1: The Scaffolding** - 项目搭建与技术栈选择
-   [x] **DevLog-2: Test-Driven Core** - 测试驱动开发实践
-   [x] **DevLog-3: The Network Foundation** - 网络层设计与实现
-   [x] **DevLog-4: Forged in the Crucible of CMake** - 构建系统的艺术
-   [x] **DevLog-5: The Steel Skeleton** - 核心架构的完善
-   [x] **DevLog-6: Unbreakable Foundations** - 稳定性与可靠性保障
-   [x] **DevLog-7: The Epic of Reliability** - 可靠性工程的史诗
-   [x] **DevLog-8: Zero-Configuration Discovery** - 零配置服务发现
-   [x] **DevLog-9: The Crucible of Integration** - 集成测试的洗礼
-   [x] **DevLog-10: The Testing Revolution** - 测试革命与质量保证
-   [x] **DevLog-11: Breakthrough** - 技术突破与创新
-   [x] **DevLog-12: Coverage Tool Migration** - 覆盖率工具迁移
-   [x] **DevLog-13: Interactive Server CLI** - 交互式服务器命令行
-   [x] **DevLog-14: The Client Library** - 客户端库的演进
-   [x] **DevLog-15: The Asynchronous Abyss** - 异步编程的深渊与重生
-   [x] **DevLog-16: Log Source Tagging** - 日志源标记与可观测性
-   [x] **DevLog-17: The Pressure Test** - 压力测试与性能验证
-   [x] **DevLog-18: The Logging System** - 日志系统的统一
-   [x] **DevLog-19: The Performance Puzzle** - 性能优化的探索之旅
-   [x] **DevLog-20: The Phoenix Project** - 从愿景到现实的完整征程

### 博客特色

-   **技术深度**: 详细的代码示例和实现讲解
-   **决策过程**: 透明化的技术选型和架构决策
-   **经验分享**: 开发过程中的经验教训和最佳实践
-   **问题解决**: 真实问题的发现、分析和解决过程
-   **持续记录**: 从概念到成熟产品的完整开发历程

---

### 阶段 7: 文档完善与生态建设

-   [x] **博客系统**: 建立完整的开发日志体系，记录技术决策和实践经验。

---

### 阶段 6：Unreal Engine 集成

*   [ ] 基于C++客户端库，开发Unreal Engine插件。
*   [ ] 插件需要提供蓝图接口，方便在游戏引擎中调用。
*   [ ] 实现玩家虚拟形象的显示和更新。

---

### 阶段 7：文档与发布

*   [ ] 完善所有公开API的文档。
*   [ ] 撰写详细的 `DESIGN.md` 和 `USER_GUIDE.md`。
*   [ ] 使用 Doxygen 生成 `API_REFERENCE.md`。
*   [ ] 将服务端程序打包为Windows和Linux应用。
*   [ ] 提供一个集成了 `client_lib` 的Unreal Engine示例项目。
*   [ ] 对所有文档进行最终审校。
*   [ ] **项目完成。**

---

## 开发日志 (DevLog)

*   ...
*   [x] DevLog-17: The-Pressure-Test.md
*   [ ] **DevLog-18: 客户端浴火重生 (The Phoenix Project: Rebuilding the Client)**
