# PICORadar 服务端 CLI 界面使用指南

## 概述

PICORadar 服务端现在支持两种运行模式：

1. **现代 CLI 界面模式**（默认）- 提供类似 GUI 的终端界面
2. **传统 CLI 模式** - 使用 `--traditional` 或 `-t` 参数启动

## 现代 CLI 界面特性

### 界面布局
```
┌─ 🎯 PICO Radar Server ──────────────────── Ctrl+C 退出 ─┐
├──────────────────────────────────────────────────────────┤
│  ┌─ 📊 服务器状态 ─┐  │  ┌─ 📋 实时日志 ─────────────┐  │
│  │ 状态: 运行中     │  │  │ 15:30:25.123 [INFO] 启动  │  │
│  │ 连接数: 3       │  │  │ 15:30:26.456 [INFO] 连接  │  │
│  └─────────────────┘  │  │ 15:30:27.789 [WARNING]   │  │
│                       │  │ ...                      │  │
│  ┌─ 📈 消息统计 ────┐  │  └─────────────────────────────┘  │
│  │ 接收: 1,234     │  │                                  │
│  │ 发送: 2,456     │  │                                  │
│  │                 │  │                                  │
│  │ 🔧 可用命令     │  │                                  │
│  │ • status       │  │                                  │
│  │ • connections  │  │                                  │
│  │ • restart      │  │                                  │
│  │ • help         │  │                                  │
│  └─────────────────┘  │                                  │
├──────────────────────────────────────────────────────────┤
│ 命令: [_____________________] ← 在此输入命令              │
└──────────────────────────────────────────────────────────┘
```

### 功能特点

1. **实时状态显示**
   - 服务器运行状态
   - 当前连接数
   - 消息收发统计

2. **实时日志显示**
   - 彩色日志级别标识
   - 精确到毫秒的时间戳
   - 自动滚动显示最新日志
   - 支持最多 1000 条日志历史

3. **交互式命令行**
   - 内置命令支持
   - 实时命令提示
   - 命令历史

## 支持的命令

### 内置命令
- `status` - 显示详细的服务器状态
- `connections` - 列出当前连接信息
- `restart` - 重启服务器（待实现）
- `help` - 显示帮助信息
- `exit` / `quit` - 优雅关闭服务器

### 使用示例
```bash
# 默认启动（使用现代 CLI 界面）
./server

# 指定端口启动
./server 8080

# 使用传统 CLI 模式
./server --traditional
./server -t

# 传统模式指定端口
./server --traditional 8080
```

## 日志系统集成

现代 CLI 界面与原有的日志系统完全兼容：

- 所有日志同时输出到终端界面和日志文件
- 保持原有的日志级别和格式
- 支持 glog 的所有特性

## 技术实现

### 使用的第三方库
- **FTXUI** - 现代化的 C++ 终端 UI 库
  - 提供组件化的界面构建
  - 支持响应式布局
  - 原生支持鼠标和键盘交互

### 架构设计
- `CLIInterface` - 主要的界面管理类
- `CLILogAdapter` - 日志系统适配器
- 线程安全的数据更新机制
- 非阻塞的界面刷新

## 性能优化

1. **内存管理**
   - 日志条目数量限制（最多 1000 条）
   - 智能界面刷新（仅在数据变更时）

2. **线程安全**
   - 使用原子操作和互斥锁
   - 避免界面阻塞主服务器线程

3. **响应性**
   - 100ms 的界面刷新间隔
   - 异步命令处理

## 故障排除

### 常见问题

1. **界面显示异常**
   ```bash
   # 使用传统模式作为备选
   ./server --traditional
   ```

2. **终端兼容性问题**
   ```bash
   # 确保终端支持 UTF-8 和颜色
   export TERM=xterm-256color
   export LC_ALL=en_US.UTF-8
   ```

3. **依赖库问题**
   ```bash
   # 重新构建依赖
   vcpkg install ftxui
   ```

## 开发者信息

### 编译要求
- CMake 3.20+
- C++17 支持
- FTXUI 库（通过 vcpkg 自动安装）

### 构建命令
```bash
# 配置构建
cmake --preset=default

# 编译
cmake --build build

# 运行
./build/src/server/server
```

## 未来计划

1. **增强功能**
   - 连接管理界面
   - 配置热重载
   - 性能监控图表

2. **用户体验**
   - 键盘快捷键支持
   - 主题定制
   - 窗口大小自适应

3. **监控集成**
   - 实时性能指标
   - 错误率统计
   - 资源使用监控
