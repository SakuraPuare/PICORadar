# 开发日志#0：从零到一，PICO Radar实时定位系统的思想之旅

**作者：书樱**
**日期：2025年7月21日**

> **摘要**: 在这篇文章里，我想和大家分享一个新项目——PICO Radar的诞生过程。它并非一蹴而就，而是经历了一系列有趣且深刻的讨论。这不仅仅是关于代码，更是关于思想的演进，关于我们如何从一个简单的想法，逐步构建出一个健壮、专业且人性化的项目蓝图。

---

大家好，我是书樱。

最近，我开启了一个激动人心的新项目，我叫它“PICO Radar”。这个想法源于一个非常实际的痛点：当很多人在同一个大空间里玩VR时，因为看不到彼此，很容易撞到一起。我们的目标就是解决这个问题——创建一个能让PICO设备在局域网内实时共享位置的系统。

今天，我想记录的不是代码，而是我们构建这个项目“宪法”的完整心路历程。

### 最初的火花：一个简洁的C/S架构

一切始于一个最简单的模型：
-   一个**中心服务器**，负责接收和广播所有人的位置。
-   若干个**客户端**（PICO设备），负责上报自己的位置，并接收其他人的位置。

技术选型上，我们很快达成了一致：
-   **C++**: 为了追求极致的性能。
-   **WebSocket**: 用于低延迟的持久连接。
-   **Protobuf**: 用于高效的数据序列化。

这套组合拳经典、高效，是我们坚实的起点。

### 第一次拷问：网络层，我们能做得更好吗？

蓝图刚画好，一个深刻的问题就被提了出来：“既然是局域网，我们为什么不直接在数据链路层（L2）用广播来通信？那不是更快吗？”

这是一个巨大的诱惑。绕过TCP/IP，直接操作原始以太网帧，理论上能获得最低的延迟。我们认真探讨了它的利弊：

-   **优点**: 延迟极低。
-   **缺点**: 复杂度极高、需要root权限、不可靠（Wi-Fi下丢包是家常便饭）、并且在WLAN环境中，广播流量的实际效率可能出奇地低。

最终，我们做出了第一个重要的架构决策：**坚持使用WebSocket (TCP)**。我们一致认为，**一个稳定、可靠、不丢包的体验，远比那几毫秒理论上的延迟优势更重要。** 用户的虚拟形象绝不能因为丢包而“瞬移”。

### 从“能用”到“好用”：构建系统的“韧性”

数据能通了，但一个“好”的系统需要考虑各种异常。于是，我们的讨论进入了深水区：

1.  **网络抖动怎么办？** 我们不能让其他玩家看起来一卡一顿。结论是，客户端**必须**实现平滑插值（Lerp/Slerp）算法，用一个微小的缓冲来抹平网络延迟的波动。
2.  **玩家掉线了怎么办？** 服务器必须有心跳和超时机制。如果一个玩家超过5秒没反应，就假定他已断开，并通知所有人将他移除。
3.  **带宽是无限的吗？** 当然不是。我们决定，只有当玩家的位置或姿态变化超过一个阈值时，客户端才上报数据。静止不动时，就没必要浪费宝贵的网络资源。

### 注入工程的灵魂：我们要做的是“产品”，而非“玩具”

当讨论到跨平台开发、代码兼容性和测试时，整个项目的格局被再次拔高了。我们意识到，我们要做的是一个符合专业标准的软件工程项目。

-   **跨平台构建**: 为了让代码能在我的Arch Linux和未来可能的Windows服务器上都能跑，**CMake**成为不二之选。
-   **模块化设计**: 我们把代码清晰地划分为`core`（纯逻辑）、`network`（网络）、`client_lib`（客户端库）等模块。这样做的好处是“高内聚、低耦合”，`core`模块甚至可以在没有网络的情况下进行完整的单元测试。
-   **兼容UE**: `client_lib`将被编译为静态库，供UE项目干净地调用，而不是把网络代码和游戏逻辑混在一起。
-   **“无硬件”测试**: 在PICO设备到位前，我们如何测试服务器？答案是开发一个**`mock_client`**（模拟客户端）。我们可以启动20个甚至更多的`mock_client`来对服务器进行功能和压力测试。这是一个至关重要的决定，它让我们的开发进度不再受硬件的制约。

### 最后的升华：极致的用户体验与专业的交付

在最后，我们又增加了两个“画龙点睛”的设计：

1.  **服务端自动发现**: 让用户在VR里输IP地址是一种灾难。我们决定采用UDP广播来实现服务发现。客户端一启动，就能自动在局域网里找到服务器并连接。这是我们送给用户和部署人员的“一份大礼”。
2.  **完整的工程流程**: 我们不满足于只有一个`README`。我们规划了完整的文档体系（设计文档、API参考、用户手册）和正式的性能测试流程。我们要用数据说话，证明我们的系统有多快、多稳。

### 总结：我们的“开发宪法”

至此，我们的思想之旅暂时告一段落。我们从一个简单的点子出发，通过一次次的追问、探讨和升华，最终形成了一份内容详尽、标准严苛的“开发宪法”。

它指引我们，要构建的不仅是一个能用的程序，更是一个可靠、健壮、易用且专业的系统。

现在，蓝图已经绘就。真正的编码之旅，即将启程。
